<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="width">
    <script>
        (function () {
            var m = document.querySelector('meta[name="viewport"]');
            if (!m) return;
            var content = 'width=device-width, initial-scale=1, viewport-fit=cover';
            function apply() { if (m.content !== content) m.setAttribute('content', content); }
            apply();
            window.addEventListener('pageshow', apply, { once: true });
            window.addEventListener('orientationchange', function () { setTimeout(apply, 0); });
        })();
    </script>
    <script>
        (function () {
            var ua = navigator.userAgent || "";
            if (/Telegram(?!Bot)/i.test(ua)) {
                var m = document.querySelector('meta[name="viewport"]');
                if (m) {
                    // Limit zoom only inside Telegram webview to prevent initial wide-layout glitch
                    var desired = 'width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover';
                    if (m.content !== desired) m.setAttribute('content', desired);
                }
                // Also force a reflow once to ensure it sticks
                document.documentElement.style.setProperty('--tg-reflow', '1');
                setTimeout(function () { document.documentElement.offsetHeight; }, 0);
            }
        })();
    </script>
    <title>Эмми & Толя — свадебное приглашение</title>
    <meta name="description" content="Одностраничное свадебное приглашение: история, место и время, дресс-код." />
    <meta name="theme-color" content="#7A9E7E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #FAF9F6; /* фон страницы */
            --paper: #FFFFFF; /* фон карточек */
            --ink: #2A2A2A; /* основной текст */
            --muted: #6B7280; /* вторичный текст */
            --accent: #7A9E7E; /* акцент (теплый беж) */
            --accent-2: #8E7A8C; /* акцент (приглушённый синий) */
            --shadow: 0 10px 30px rgba(0,0,0,.08);
            --radius: 20px;
            --btn-ink: #ffffff;
            --btn-bg: #7A9E7E;
            --btn-bg-hover: #698D6D;
            --btn-outline-ink: var(--accent);
            --btn-outline-bg: transparent;
            --btn-outline-bg-hover: #00000008;
            --focus: 0 0 0 3px rgba(122,158,126,.32);
        }

        *, *::before, *::after {
            box-sizing: border-box
        }

        html, body {
            height: 100%;
            overscroll-behavior-y: none;
        }

        html {
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
            scroll-behavior: auto
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--ink);
            font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
            line-height: 1.55;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
            line-height: 1.15;
            margin: 0 0 .6em;
            color: var(--ink)
        }

        h1 {
            font-size: clamp(38px, 6vw, 76px);
            font-weight: 700
        }

        h2 {
            font-size: clamp(26px, 4vw, 42px);
            font-weight: 600
        }

        h3 {
            font-size: clamp(20px, 3vw, 28px);
            font-weight: 600
        }

        p {
            margin: .6em 0
        }

        a {
            color: inherit
        }

        .wrap {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px
        }

        /* Кнопки */
        .btn {
            --_bg: var(--btn-bg);
            --_ink: var(--btn-ink);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            border: 0;
            background: var(--_bg);
            color: var(--_ink);
            padding: 12px 18px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 15px;
            text-decoration: none;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform .12s ease, background .2s ease, box-shadow .2s ease;
            will-change: transform;
            touch-action: manipulation;
        }

            .btn:hover {
                transform: translateY(-1px);
            }

            .btn:active {
                transform: translateY(0);
            }

            .btn:focus-visible {
                outline: none;
                box-shadow: var(--focus);
            }

            .btn svg {
                width: 20px;
                height: 20px;
                flex: 0 0 20px
            }

        .btn-primary {
            --_bg: var(--btn-bg);
            --_ink: #fff;
        }

            .btn-primary:hover {
                background: var(--btn-bg-hover);
            }

        .btn-outline {
            --_bg: var(--btn-outline-bg);
            --_ink: var(--btn-outline-ink);
            border: 1.5px solid var(--accent);
            box-shadow: none;
            background: var(--btn-outline-bg);
        }

            .btn-outline:hover {
                background: var(--btn-outline-bg-hover);
            }

        .btn-ghost {
            --_bg: transparent;
            --_ink: #fff;
            border: 1.5px solid rgba(255,255,255,.55);
            background: transparent;
            color: #fff;
            box-shadow: none;
        }

            .btn-ghost:hover {
                background: rgba(255,255,255,.08);
            }

        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 16px;
        }

        /* Секция 1: кроссфейд фото */
        .crossfade {
            height: 220vh;
            position: relative;
            padding: 0;
            background: #000
        }

            .crossfade .sticky {
                position: sticky;
                top: 0;
                height: 100vh;
                overflow: hidden
            }

        .photo-frame {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
            border-radius: 0;
        }

        .photo {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: opacity .5s ease, transform .5s ease;
            transform: translateZ(0);
        }
        /* --- Responsive viewport-height fixes --- */
        @supports (height: 100dvh) {
            .crossfade {
                height: 220dvh;
            }

            .sticky {
                height: 100dvh;
            }
        }

        @media (max-width: 600px) {
            .crossfade {
                height: 160vh;
            }
        }

        @supports (height: 100dvh) {
            @media (max-width: 600px) {
                .crossfade {
                    height: 160dvh;
                }
            }
        }

        /* Layer wrappers for responsive images */
        .photo-layer {
            position: absolute;
            inset: 0;
            will-change: opacity, transform;
        }

            .photo-layer > img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: center;
                transition: opacity .5s ease, transform .5s ease;
                transform: translateZ(0);
            }

            .photo-layer.child {
                z-index: 1;
            }

            .photo-layer.adult {
                z-index: 2;
                opacity: 0;
            }


        .photo.child {
            z-index: 1;
        }

        .photo.adult {
            z-index: 2;
            opacity: 0
        }

        .photo-overlay {
            position: absolute;
            z-index: 3;
            background: rgba(255,255,255,.75);
            color: var(--ink);
            padding: 8px 12px;
            border-radius: 999px;
            font-size: 12px;
            letter-spacing: .06em;
            text-transform: uppercase;
            box-shadow: var(--shadow)
        }

        .intro-title {
            position: absolute;
            inset: auto 0 7vh 0;
            z-index: 3;
            text-align: center;
            color: #fff;
            text-shadow: 0 6px 30px rgba(0,0,0,.45);
            padding: 0 16px;
        }

            .intro-title .names {
                font-family: 'Playfair Display', serif;
                font-weight: 700;
                letter-spacing: .02em;
                font-size: clamp(42px,7vw,96px)
            }

            .intro-title .date {
                font-size: clamp(16px,2.2vw,22px);
                opacity: .95
            }

        .gradient-top, .gradient-bottom {
            position: absolute;
            left: 0;
            right: 0;
            height: 25vh;
            z-index: 2;
            pointer-events: none
        }

        .gradient-top {
            top: 0;
            background: linear-gradient(#0006, transparent)
        }

        .gradient-bottom {
            bottom: 0;
            background: linear-gradient(transparent, #0007)
        }

        /* Секция 2: аннотация */
        section {
            padding: 80px 0
        }

        /* Единый промежуток между секциями */
        :root {
            --section-gap: clamp(22px, 6vw, 30px);
        }

        /* Промежутки между секциями */
        body {
            display: grid;
            grid-auto-rows: max-content;
            row-gap: var(--section-gap);
        }

            /* На всякий случай обнулим внешние отступы у секций */
            body > section {
                margin: 0;
            }

        section + section {
            margin-top: var(--section-gap);
        }

        /* спецслучай: кроссфейд перекрывает низ, поэтому добавим «прокладку» */
        .crossfade::after {
            content: "";
            display: block;
            height: var(--section-gap);
            background: var(--bg); /* фон страницы */
        }

        .card {
            background: var(--paper);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: clamp(22px,3.2vw,44px)
        }

        .lead {
            font-size: clamp(18px, 2.1vw, 22px);
            color: var(--muted)
        }

        .grid {
            display: grid;
            gap: 24px
        }

        @media(min-width:860px) {
            .grid.cols-2 {
                grid-template-columns: 1.2fr .8fr
            }
        }

        @supports (content-visibility:auto) {
            .card, .detail {
                content-visibility: auto;
                contain-intrinsic-size: 600px 400px;
            }
        }


        /* Мобильные твики обложки */
        @media (max-width:600px) {
            .crossfade {
                height: 180svh;
            }

            .card, .detail {
                box-shadow: 0 8px 22px rgba(0,0,0,.06);
            }
        }

        .photo {
            will-change: opacity, transform;
        }
        /* более плавный GPU-скролл */


        .quote {
            font-family: 'Playfair Display', serif;
            font-size: clamp(22px,2.6vw,30px);
            color: var(--accent);
            margin: 0 0 16px
        }

        /* Секция 3: основное содержание */
        .details-grid {
            display: grid;
            gap: 18px
        }

        @media(min-width:820px) {
            .details-grid {
                grid-template-columns: repeat(3,1fr)
            }
        }

        .detail {
            background: var(--paper);
            border-radius: 16px;
            padding: 22px;
            box-shadow: var(--shadow)
        }

        .kicker {
            color: var(--accent);
            font-size: 12px;
            letter-spacing: .12em;
            text-transform: uppercase;
            margin-bottom: 8px
        }

        .big {
            font-size: clamp(18px,2.5vw,24px)
        }

        .timeline {
            display: grid;
            gap: 14px;
            margin-top: 10px
        }

        .slot {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 12px;
            align-items: start
        }

        .time {
            font-variant-numeric: tabular-nums;
            font-weight: 600;
            color: var(--accent-2)
        }

        /* Countdown */
        .countdown {
            --pill: 10px;
            display: grid;
            grid-auto-flow: column;
            gap: 10px;
            width: fit-content;
            margin-top: 12px;
            font-variant-numeric: tabular-nums;
        }

        .cd-item {
            background: #F3F6F2;
            border-radius: 12px;
            padding: 8px 10px;
            text-align: center;
            box-shadow: inset 0 0 0 1px #E1EAE1;
            min-width: 70px;
            width: var(--w, 60px);
        }

            .cd-item.days { /* запас под 3-значные дни */
                --w: 70px;
            }

            .cd-item .num {
                font-weight: 700;
                font-size: 20px; /* ← точка с запятой */
                font-variant-numeric: tabular-nums;
                font-feature-settings: "tnum" 1;
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New",monospace;
                text-align: center;
            }

            .cd-item .lbl {
                display: block;
                font-size: 12px;
                color: var(--muted);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis; /* на всякий */
                margin-top: 2px
            }

        #cd-days {
            inline-size: 3ch;
        }

        #cd-hours, #cd-mins, #cd-secs {
            inline-size: 2ch;
        }

        /* Кнопки не ниже 44px по гайдлайнам iOS/Android */
        .btn {
            min-height: 44px;
        }

        /* Длинные адреса не «ломают» строку на узких экранах */
        #venueAddress {
            overflow-wrap: anywhere;
            word-break: break-word;
        }

        /* Палитра дресс-кода */
        .detail.dresscode .palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(86px,1fr));
            gap: 16px 12px;
            margin-top: 10px;
        }

            .detail.dresscode .palette > div {
                display: grid;
                justify-items: center;
            }

        .detail.dresscode .swatch {
            --c: #d9c8b4;
            width: 64px;
            height: 64px;
            border-radius: 14px;
            background: var(--c);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,.06); /* без «пухлых» теней */
        }

        .detail.dresscode .swatch-label {
            font-size: 12px;
            color: var(--muted);
            text-align: center;
            line-height: 1.15;
            max-width: 80px; /* чтобы длинные названия красиво переносились */
        }

        /* Плавное появление блоков при скролле */
        .reveal {
            opacity: 0;
            --lift: 20px; /* смещение вниз до появления */
            transition: opacity .6s ease, transform .6s ease;
        }

            .reveal.in {
                opacity: 1;
                --lift: 0px; /* обнуляем смещение */
            }

        /* Футер */
        footer {
            padding: 50px 0 90px;
            color: var(--muted);
            text-align: center
        }

        @media (prefers-reduced-motion: reduce) {
            .photo {
                transition: none
            }

            .crossfade {
                height: 120vh
            }

            .photo.adult {
                opacity: 1
            }

            .reveal {
                opacity: 1;
                transform: none
            }
        }

        /* Печать */
        @media print {
            .crossfade {
                height: auto
            }

                .crossfade .sticky {
                    position: relative;
                    height: auto
                }

            .gradient-top, .gradient-bottom, .photo-overlay, .actions {
                display: none
            }

            section {
                padding: 24px 0
            }

            .card, .detail {
                box-shadow: none;
                border: 1px solid #EAE7E2
            }

            section + section {
                margin-top: 16px;
            }
        }
    
.music-toggle.is-playing .icon{width:18px;height:18px;border:0;position:relative}
.music-toggle.is-playing .icon::before,
.music-toggle.is-playing .icon::after{content:"";position:absolute;top:0;bottom:0;width:5px;background:#fff;border-radius:1px}
.music-toggle.is-playing .icon::before{left:2px}
.music-toggle.is-playing .icon::after{right:2px}

</style>

    <style>
        /* --- Fix: avoid content-visibility "jump" on mobile webviews --- */
        @supports (content-visibility:auto) {
            @media (max-width: 860px) {
                .card, .detail {
                    content-visibility: visible;
                    contain-intrinsic-size: auto;
                }
            }
        }
    </style>


    <style>
        /* Center the "scroll down" pill above the safe area on mobile */
        .photo-overlay {
            left: 50%;
            right: auto;
            top: auto;
            bottom: calc(16px + env(safe-area-inset-bottom));
            transform: translateX(-50%);
            background: rgba(255,255,255,.78);
            -webkit-backdrop-filter: saturate(140%) blur(6px);
            backdrop-filter: saturate(140%) blur(6px);
            padding: 10px 14px;
            border-radius: 999px;
            font-size: clamp(11px, 2.8vw, 13px);
            letter-spacing: .06em;
            text-transform: uppercase;
            pointer-events: none; /* don't block taps on the hero */
            box-shadow: var(--shadow);
        }
            /* Hide the hint after the first scroll or on very short viewports */
            .photo-overlay.--hide {
                opacity: 0;
                transform: translate(-50%, 6px);
                transition: opacity .35s ease, transform .35s ease;
            }

        @media (max-height: 520px) {
            .photo-overlay {
                display: none;
            }
        }
    </style>

    <style>
        /* --- Боке/лепестки --- */
        .fx-bokeh {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 2;
            transform: translateZ(0);
            backface-visibility: hidden;
            contain: strict;
        }

        @media (prefers-reduced-motion: reduce), print {
            .fx-bokeh {
                display: none !important;
            }
        }

        /* --- Лёгкий 3D-tilt карточек --- */
        .card, .detail {
            transform: translateZ(0);
        }

        .tilt {
            will-change: transform;
            transform: perspective(1000px) translateY(var(--lift, 0px)) /* <— добавили */
            rotateX(var(--rx, 0deg)) rotateY(var(--ry, 0deg)) translate3d(var(--tx, 0px), var(--ty, 0px), 0);
            transition: transform .12s ease, box-shadow .2s ease;
            transform-style: preserve-3d;
        }


            .tilt:hover {
                box-shadow: 0 14px 40px rgba(0,0,0,.12);
            }

        /* Параллакс обложки от наклона */
        .crossfade .photo-layer {
            transform: translate3d(var(--gx,0px), var(--gy,0px), 0);
            transition: transform .15s ease;
        }
    </style>



<style>
/* === Names + hearts + mobile tap fix + haptic pulse === */
.intro-title .names .name-btn{
  background:none;border:0;padding:0;margin:0;color:inherit;font:inherit;cursor:pointer;
  -webkit-appearance:none; appearance:none; background-color:transparent;
  -webkit-tap-highlight-color: transparent;
}
.intro-title .names .name-btn:focus-visible{ outline: 2px solid rgba(255,105,180,.6); outline-offset: 4px; border-radius: 6px; }
.intro-title .names .name-btn:active{ transform: scale(.98); background:none; }
.intro-title .names .amp{ user-select:none; }

/* visual micro-pulse as an iOS fallback */
@keyframes hapticPulse { 0%{transform:scale(1)} 50%{transform:scale(.985)} 100%{transform:scale(1)} }
.name-btn.haptic-pulse{ animation: hapticPulse 80ms ease-out; }

/* floating hearts */
.love-heart{
  position:fixed; left:0; top:0; z-index:50; pointer-events:none;
  font-size:28px; will-change: transform, opacity; opacity:0;
  transform: translate(-50%,-50%) rotate(var(--rot,0deg));
  animation: heartFloat 950ms ease-out forwards;
  text-shadow: 0 6px 14px rgba(0,0,0,.25);
}
@keyframes heartFloat{
  0%   { opacity:0; transform: translate(calc(-50% + 0px), -2px) rotate(var(--rot,0deg)) scale(.85); }
  18%  { opacity:1; }
  100% { opacity:0; transform: translate(calc(-50% + var(--drift, 0px)), -78px) rotate(calc(var(--rot,0deg) + 8deg)) scale(1.25); }
}
@media (prefers-reduced-motion: reduce){ .love-heart{ animation-duration:0ms; opacity:1; } }
</style>

  <!-- === Social preview (Open Graph / Twitter) === -->
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:title" content="Эмми & Толя — свадебное приглашение">
  <meta property="og:description" content="Приглашение на свадьбу 27 июля 2027 • Воронеж.">
  <meta property="og:image" content="assets/social-card-1200x630-vrn.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:alt" content="Эмми и Толя — 27.07.2027, Воронеж">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Эмми & Толя — свадебное приглашение">
  <meta name="twitter:description" content="Приглашение на свадьбу 27 июля 2027 • Воронеж.">
  <meta name="twitter:image" content="assets/social-card-1200x630-vrn.jpg">
  <!-- /Social preview -->

<style id="global-reset">
  html,body{margin:0;padding:0}
</style>


<style id="music-css">
/* === Music toggle button === */
.music-toggle{position:fixed;right:max(14px,env(safe-area-inset-right));bottom:calc(14px + env(safe-area-inset-bottom));z-index:60;width:56px;height:56px;aspect-ratio:1/1;border-radius:999px;border:0;background:rgba(30,30,30,.78);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.24);display:flex;align-items:center;justify-content:center;cursor:pointer;backdrop-filter:saturate(140%) blur(6px);line-height:0}
.music-toggle:focus-visible{ outline:2px solid rgba(255,105,180,.65); outline-offset:3px; }
.music-toggle .icon{display:block;width:0;height:0;border-style:solid;border-width:9px 0 9px 15px;border-color:transparent transparent transparent #fff}
.music-toggle.is-playing{ background: rgba(227, 59, 100, .9); }



/* Hidden file input for optional user track */
#musicFileInput{ display:none; }
</style>


<style id="music-css-fix">
/* Safe, minimal styles to guarantee clickability */
.music-toggle{position:fixed;right:16px;bottom:16px;z-index:9999;
  width:52px;height:52px;border:0;border-radius:999px;
  background:rgba(35,35,35,.9);color:#fff;cursor:pointer;
  display:inline-flex;align-items:center;justify-content:center;
  box-shadow:0 8px 20px rgba(0,0,0,.25);-webkit-backdrop-filter:saturate(140%) blur(6px);backdrop-filter:saturate(140%) blur(6px);}
.music-toggle .icon{display:block;width:0;height:0;border-style:solid;border-width:10px 0 10px 16px;border-color:transparent transparent transparent #fff}
.music-toggle.is-playing .icon{width:20px;height:20px;border:0;position:relative}
.music-toggle.is-playing .icon::before,.music-toggle.is-playing .icon::after{content:"";position:absolute;top:0;bottom:0;width:6px;background:#fff;border-radius:1px}
.music-toggle.is-playing .icon::before{left:2px}.music-toggle.is-playing .icon::after{right:2px}
.music-toggle:focus-visible{outline:2px solid rgba(255,105,180,.65);outline-offset:3px}
</style>

<style id="novolume-hide">
/* Force-hide any leftover volume UI (safety) */
.music-volume, .volume-btn, .volume-panel, .vol-range { display: none !important; visibility: hidden !important; }
</style>


    <style>
      /* Fix hover cursor flicker on links styled as buttons:
         keep hand cursor on all inner content and route events to the anchor */
      a.btn, a.btn * { cursor: pointer; }
      a.btn * { pointer-events: none; }
    </style>
    
</head>
<body>
    <!-- СЕКЦИЯ 1. Кроссфейд: детское → взрослое фото -->
    <!-- TODO: замените src на свои файлы (child.jpg и adult.jpg). Рекомендуемое соотношение 3:2 или 16:9, минимум ~1800px по ширине. -->
    <section class="crossfade" aria-label="Обложка-приглашение">
        <div class="sticky">
            <div class="photo-frame">
                <picture class="photo-layer child">
                    <source media="(max-width: 600px)"
                            srcset="assets/child-mobile-720x960.jpg 720w,
                                    assets/child-mobile-1080x1440.jpg 1080w,
                                    assets/child-mobile-1440x1920.jpg 1440w"
                            sizes="100vw" />
                    <source media="(min-width: 601px)"
                            srcset="assets/child-desktop-1280x853.jpg 1280w,
                                    assets/child-desktop-1920x1280.jpg 1920w,
                                    assets/child-desktop-2880x1920.jpg 2880w"
                            sizes="100vw" />
                    <img src="assets/child.jpg" alt="Эмми и Толя — детское фото"
                         width="1920" height="1280"
                         decoding="async" fetchpriority="high" loading="eager" />
                </picture>
                <picture class="photo-layer adult">
                    <source media="(max-width: 600px)"
                            srcset="assets/adult-mobile-720x960.jpg 720w,
                                    assets/adult-mobile-1080x1440.jpg 1080w,
                                    assets/adult-mobile-1440x1920.jpg 1440w"
                            sizes="100vw" />
                    <source media="(min-width: 601px)"
                            srcset="assets/adult-desktop-1280x853.jpg 1280w,
                                    assets/adult-desktop-1920x1280.jpg 1920w,
                                    assets/adult-desktop-2880x1920.jpg 2880w"
                            sizes="100vw" />
                    <img src="assets/adult.jpg" alt="Эмми и Толя — современное фото"
                         width="1920" height="1280"
                         decoding="async" loading="lazy" />
                </picture>
                <div class="gradient-top"></div>
                <div class="gradient-bottom"></div>
                <div class="intro-title wrap">
                    <div class="names"><button id="nameTolya" class="name-btn" type="button" aria-label="Толя">Толя</button><span class="amp" aria-hidden="true">&nbsp;&amp;&nbsp;</span><button id="nameEmmi" class="name-btn" type="button" aria-label="Эмми">Эмми</button></div>
                    <!-- TODO: замените дату -->
                    <div class="date"><time datetime="2027-07-27">Вторник, 27 июля 2027</time></div>
                    <!-- Кнопка: Добавить в календарь -->
                    <div class="actions" role="group" aria-label="Быстрые действия">
                        <a href="#" class="btn btn-primary" id="addToCalendarBtn">
                            <!-- иконка календарь -->
                            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none">
                                <path d="M7 3v4M17 3v4M3 11h18M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                            Добавить в календарь
                        </a>
                        <a href="#details" class="btn btn-ghost">
                            <svg aria-hidden="true" viewBox="0 0 24 24" fill="none">
                                <path d="M12 5v14m0 0l-6-6m6 6 6-6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                            </svg>
                            К подробностям
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- СЕКЦИЯ 2. Аннотация о молодожёнах -->
    <section class="wrap" id="about">
        <div class="card grid cols-2 reveal">
            <div>
                <h2>Немного о нас</h2>
                <p class="lead">Мы встретились в детском лагере. Он, она, боже... Сами всё видите, раз приглашение вам пришло. Без слов, только горька!</p>
                <p>Любим не досматривать фильмы под жёсткий секс. А дальше вам знать не надо. И ещё раз точка. Ладно, не точка. Эмми и Толя aka кофе со сливками</p>
            </div>
            <div>
                <p class="quote">«Главное — быть рядом и вовремя делиться последним кусочком пиццы.» - это гпт написал. <br> Ps: «Ну вообще, точки не должно быть после "пиццы", а после ковычек - запятая», - это писала Эмми"</p>
                <p style="color:var(--muted)">Эмми: «Если коротко: это выглядит ужасно, зато с какой душой!» <br> Толя: «Это про меня?» <br> Толя: «Ну, а если реально, "коротко" - это не про нас)»</p>
            </div>
        </div>
    </section>

    <!-- СЕКЦИЯ 3. Основное содержание: место, время, дресс-код -->
    <section class="wrap" id="details">
        <div class="details-grid">
            <!-- Дата/время + таймер -->
            <div class="detail reveal" aria-labelledby="dt-title">
                <div class="kicker" id="dt-title">Дата и время</div>
                <!-- TODO: замените дату и тайминг под себя -->
                <div class="big"><strong><span id="eventDateText">27 июля 2027</span></strong></div>

                <!-- Таймер обратного отсчёта -->
                <div class="countdown" id="countdown" aria-live="polite" title="Сколько осталось до события" hidden>
                    <div class="cd-item days">
                        <span class="num" id="cd-days">00</span>
                        <span class="lbl" id="cd-days-lbl" title="дней">дн</span>
                    </div>
                    <div class="cd-item">
                        <span class="num" id="cd-hours">00</span>
                        <span class="lbl" id="cd-hours-lbl" title="часов">ч</span>
                    </div>
                    <div class="cd-item">
                        <span class="num" id="cd-mins">00</span>
                        <span class="lbl" id="cd-mins-lbl" title="минут">мин</span>
                    </div>
                    <div class="cd-item">
                        <span class="num" id="cd-secs">00</span>
                        <span class="lbl" id="cd-secs-lbl" title="секунд">с</span>
                    </div>
                </div>
                <div id="countdownNote" class="lead" style="margin-top:8px;color:var(--muted)"></div>

                <div class="timeline" style="margin-top:14px">
                    <div class="slot"><div class="time">14:00</div><div>Сбор гостей</div></div>
                    <div class="slot"><div class="time">14:30</div><div>Подарки</div></div>
                    <div class="slot"><div class="time">14:59</div><div>Банкет</div></div>
                    <div class="slot"><div class="time">15:00</div><div>Уход гостей</div></div>
                    <div class="slot"><div class="time">16:00</div><div>Церемония</div></div>
                    <div class="slot"><div class="time">17:30</div><div>Фотосессия и велкам-чан</div></div>
                    <div class="slot"><div class="time">19:00</div><div>Ужин и танцы</div></div>
                    <div class="slot"><div class="time">20:00</div><div>Любимые дела (Смотреть "О нас")</div></div>
                </div>
            </div>

            <!-- Локация + кнопка Открыть маршрут -->
            <div class="detail reveal" aria-labelledby="loc-title">
                <div class="kicker" id="loc-title">Локация</div>
                <!-- TODO: укажите адрес площадки и при желании — ориентиры -->
                <div class="big"><strong>Хвоя</strong></div>
                <p id="venueAddress">
                    Рамонский р-н, Айдаровское сельское поселение, с. Чертовицы, Солнечная ул., 14А
                </p>
                <p style="color:var(--muted)">Парковка около забора, гардероб внутри. Навигатор подскажет дорогу — главное, приезжайте с деньгами, потом скинем чек, разделите.</p>

                <div class="actions" style="justify-content:flex-start">
                    <a class="btn btn-outline" id="openRouteBtn"
                       data-address="Рамонский р-н, Айдаровское сельское поселение, с. Чертовицы, Солнечная ул., 14А">
                        <svg aria-hidden="true" viewBox="0 0 24 24" fill="none">
                            <path d="M12 2v3m0 14v3M3 12h3m12 0h3M5.5 5.5l2.1 2.1M16.4 16.4l2.1 2.1M5.5 18.5l2.1-2.1M16.4 7.6l2.1-2.1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
                        </svg>
                        Открыть маршрут
                    </a>
                </div>
            </div>

            <!-- Дресс-код -->
            <div class="detail reveal dresscode" aria-labelledby="dc-title">
                <div class="kicker" id="dc-title">Дресс-код</div>
                <div class="big">Смарт-кэжуал в мягких оттенках</div>

                <div class="palette" aria-label="Палитра дресс-кода">
                    <div><div class="swatch" style="--c:#EED8C9"></div><div class="swatch-label">песок</div></div>
                    <div><div class="swatch" style="--c:#CBB1A0"></div><div class="swatch-label">латте</div></div>
                    <div><div class="swatch" style="--c:#8FA7C9"></div><div class="swatch-label">дымчатый синий</div></div>
                    <div><div class="swatch" style="--c:#6C7A89"></div><div class="swatch-label">графит</div></div>
                    <div><div class="swatch" style="--c:#F5F4EF; box-shadow: inset 0 0 0 1px #E1EAE1"></div><div class="swatch-label">айвори</div></div>
                </div>

                <p style="color:var(--muted);margin-top:12px">
                    Пожалуйста, избегайте ярко-кислотных цветов и чисто белого total-look.
                </p>
            </div>
        </div>
    </section>

    <!-- СЕКЦИЯ 4. Небольшое завершение -->
    <section class="wrap">
        <div class="card reveal">
            <h3>Важно</h3>
            <p>Будем рады, если вы без детей, но препятствовать им не будем: пусть это будет маленький взрослый праздник. Если у вас есть вопросы по меню или транспорту — просто не пишите нам. А ещё, никакой древней музыки не будет, будем изучать современный свэг и Егора Крида. Свэг, если что, это стиль!</p>
            <p class="lead" style="margin-top:10px">Надеемся, вы не придёте!<br>С любовью, Эмми и Толя</p>

            <!-- Кнопка: Написать в Telegram -->
            <div class="actions" style="margin-top:14px;justify-content:flex-start">
                <a class="btn btn-primary" href="https://t.me/flaylip" target="_blank" rel="noopener">
                    <svg aria-hidden="true" viewBox="0 0 24 24" fill="none">
                        <path d="M21.8 3.4 2.9 10.3c-.7.3-.7 1.3 0 1.5l4.8 1.5 1.9 5.9c.2.6 1 .7 1.4.2l2.7-3.1 4.8 3.6c.5.4 1.2.1 1.3-.6l2.3-14.4c.1-.7-.5-1.2-1.3-.9Z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" />
                    </svg>
                    Написать в Telegram (Эмми)
                </a>
            </div>

            <!-- Кнопка: Написать в Telegram -->
            <div class="actions" style="margin-top:14px;justify-content:flex-start">
                <a class="btn btn-primary" href="https://t.me/chtoliaa" target="_blank" rel="noopener">
                    <svg aria-hidden="true" viewBox="0 0 24 24" fill="none">
                        <path d="M21.8 3.4 2.9 10.3c-.7.3-.7 1.3 0 1.5l4.8 1.5 1.9 5.9c.2.6 1 .7 1.4.2l2.7-3.1 4.8 3.6c.5.4 1.2.1 1.3-.6l2.3-14.4c.1-.7-.5-1.2-1.3-.9Z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" />
                    </svg>
                    Написать в Telegram (Толя)
                </a>
            </div>
        </div>
    </section>

    <footer>
        <div class="wrap">© Эмми & Толя · 2025</div>
    </footer>

    <script>
        // ------------------------------
        // УТИЛИТЫ
        // ------------------------------
        const $ = (sel, root = document) => root.querySelector(sel);
        const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
        const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
        const pad2 = (n) => String(n).padStart(2, '0');

        // Словоформы
        function decl(n, forms) {
            n = Math.abs(n) % 100; const n1 = n % 10;
            if (n > 10 && n < 20) return forms[2];
            if (n1 > 1 && n1 < 5) return forms[1];
            if (n1 === 1) return forms[0];
            return forms[2];
        }

        // ------------------------------
        // 1) Кроссфейд детское → взрослое фото
        // ------------------------------
        (function () {
            const $ = sel => document.querySelector(sel);
            const cross = $('.crossfade'); if (!cross) return;
            const sticky = cross.querySelector('.sticky');
            const child = sticky.querySelector('.photo-layer.child');
            const adult = sticky.querySelector('.photo-layer.adult');

            function clamp(v, a = 0, b = 1) { return Math.min(b, Math.max(a, v)); }

            function render() {
                const rect = cross.getBoundingClientRect();
                const vh = sticky.clientHeight || window.innerHeight;
                const total = cross.offsetHeight - vh;
                const progressed = clamp(-rect.top, 0, total);
                const t = total > 0 ? progressed / total : 0;
                const start = 0.20, end = 0.80;
                let p = clamp((t - start) / (end - start));
                p = p * p * (3 - 2 * p);

                adult.style.opacity = p.toFixed(3);
                child.style.transform = `scale(${1 + 0.05 * p})`;
                adult.style.transform = `scale(${1.03 - 0.03 * p})`;
            }

            let ticking = false;
            const onScroll = () => { if (!ticking) { ticking = true; requestAnimationFrame(() => { render(); ticking = false; }); } };
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', render);
            render();
        })();

        // ------------------------------
        // 2) Плавное появление блоков
        // ------------------------------
        (function () {
            const els = document.querySelectorAll('.reveal');
            if (!('IntersectionObserver' in window)) {
                els.forEach(el => el.classList.add('in'));
                return;
            }
            const io = new IntersectionObserver((entries) => {
                entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('in'); io.unobserve(e.target); } });
            }, { threshold: 0.2 });
            els.forEach(el => io.observe(el));
        })();

        // ------------------------------
        // 3) Кнопка "Открыть маршрут"
        // ------------------------------
        (function () {
            const btn = document.querySelector('#openRouteBtn');
            if (!btn) return;

            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const addr = btn.dataset.address
                    || document.querySelector('#venueAddress')?.textContent?.trim()
                    || '';
                const encoded = encodeURIComponent(addr);

                // Маршрут на Яндекс.Картах (режим: авто)
                const url = `https://yandex.ru/maps/?rtext=~${encoded}&rtt=auto`;

                // На случай отключённого JS — прописываем href
                btn.setAttribute('href', url);
                btn.setAttribute('target', '_blank');
                btn.setAttribute('rel', 'noopener');

                window.open(url, '_blank', 'noopener');
            });
        })();

        // ------------------------------
        // 4) Кнопка "Добавить в календарь" (генерация .ics)
        // ------------------------------
        (function () {
            const btn = $('#addToCalendarBtn');
            if (!btn) return;

            // TODO: при необходимости измените дату/время и продолжительность
            const title = 'Свадьба — Эмми & Толя';
            const location = $('#venueAddress')?.textContent?.trim() || 'Локация уточняется';
            // Предполагаем московский часовой пояс +03:00
            const start = new Date('2027-07-27T14:00:00+03:00'); // начало
            const end = new Date('2027-07-27T22:00:00+03:00');   // конец
            const description = 'Будем рады видеть вас!';

            function toICSDateUTC(d) {
                const y = d.getUTCFullYear();
                const m = pad2(d.getUTCMonth() + 1);
                const day = pad2(d.getUTCDate());
                const hh = pad2(d.getUTCHours());
                const mm = pad2(d.getUTCMinutes());
                const ss = pad2(d.getUTCSeconds());
                return `${y}${m}${day}T${hh}${mm}${ss}Z`;
            }

            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const ics =
                    `BEGIN:VCALENDAR
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
PRODID:-//emmi-tolya//invite//RU
BEGIN:VEVENT
UID:${Date.now()}@emmi-tolya
DTSTAMP:${toICSDateUTC(new Date())}
DTSTART:${toICSDateUTC(start)}
DTEND:${toICSDateUTC(end)}
SUMMARY:${title}
LOCATION:${location}
DESCRIPTION:${description}
END:VEVENT
END:VCALENDAR`;

                const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'wedding-emmi-tolya.ics';
                document.body.appendChild(a);
                a.click();
                URL.revokeObjectURL(url);
                a.remove();
            });
        })();

        // ------------------------------
        // 5) Таймер обратного отсчёта под датой
        // ------------------------------
        (function () {
            const box = $('#countdown');
            const note = $('#countdownNote');
            if (!box) return;

            // Время старта события (совпадает с "Сбор гостей")
            const start = new Date('2027-07-27T14:00:00+03:00').getTime();

            function tick() {
                const now = Date.now();
                let diff = Math.floor((start - now) / 1000); // секунды
                if (diff <= 0) {
                    box.hidden = true;
                    if (note) note.textContent = 'Событие уже началось или прошло 🎉';
                    return;
                }
                box.hidden = false;

                const days = Math.floor(diff / 86400); diff -= days * 86400;
                const hours = Math.floor(diff / 3600); diff -= hours * 3600;
                const mins = Math.floor(diff / 60); diff -= mins * 60;
                const secs = diff;

                $('#cd-days').textContent = pad2(days);
                $('#cd-hours').textContent = pad2(hours);
                $('#cd-mins').textContent = pad2(mins);
                $('#cd-secs').textContent = pad2(secs);

                $('#cd-days-lbl').title = decl(days, ['день', 'дня', 'дней']);
                $('#cd-hours-lbl').title = decl(hours, ['час', 'часа', 'часов']);
                $('#cd-mins-lbl').title = decl(mins, ['минута', 'минуты', 'минут']);
                $('#cd-secs-lbl').title = decl(secs, ['секунда', 'секунды', 'секунд']);

            }

            tick();
            setInterval(tick, 1000);
        })();
    </script>

    <script>
        /* =========================
         * FX A (v5). Только лепестки, БЕЗ теней/боке, спрайтовая отрисовка
         * — медленно без скролла, быстро при скролле
         * ========================= */
        (function () {
            if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            // Канвас (переиспользуем, если уже есть)
            const c = document.getElementById('fx-bokeh') || (() => {
                const el = document.createElement('canvas');
                el.id = 'fx-bokeh'; el.className = 'fx-bokeh'; el.setAttribute('aria-hidden', 'true');
                // антиподёргивания слоя
                el.style.transform = 'translateZ(0)';
                el.style.backfaceVisibility = 'hidden';
                el.style.contain = 'strict';
                document.body.appendChild(el);
                return el;
            })();
            const ctx = c.getContext('2d', { alpha: true });
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';

            const isMobile = /Mobi|Android/i.test(navigator.userAgent);
            let dpr = Math.min(window.devicePixelRatio || 1, isMobile ? 1.25 : 2);

            function resize() {
                c.width = Math.floor(innerWidth * dpr);
                c.height = Math.floor(innerHeight * dpr);
                c.style.width = '100%'; c.style.height = '100%';
            }
            resize(); addEventListener('resize', resize);

            // --- ТЮНИНГ ---
            const COLORS = ['#EBD9D7', '#CFE3D2', '#F7F3EC', '#D9B5B8']; // blush, pale sage, ivory, dusty rose // чистые пастельные
            const MAX = Math.min(200, Math.round((innerWidth * innerHeight) / 8000)); // предел частиц по площади
            const SPEED_Y_MIN = 0.040; // px/ms
            const SPEED_Y_MAX = 0.090; // px/ms
            const ROT_SPEED = 0.0022; // рад/мс
            const LIFE_DECAY = 0.00022; // убывание жизни за мс
            const BURST_BASE = 10;      // базовое кол-во при событии скролла
            const BURST_GAIN_PER_100PX = 10;
            const SPAWN_THROTTLE_MS = 60;
            const IDLE_FACTOR = 0.16;    // 0..1 — доля скорости без прокрутки (очень медленно)

            // ---- Спрайты лепестков (без теней) ----
            const SPRITES = new Map();
            function makeSprite(color, size) {
                const S = Math.max(8, size | 0);
                const off = (typeof OffscreenCanvas !== 'undefined')
                    ? new OffscreenCanvas(S, S)
                    : Object.assign(document.createElement('canvas'), { width: S, height: S });

                const cx = off.getContext('2d');
                cx.imageSmoothingEnabled = true; cx.imageSmoothingQuality = 'high';
                cx.translate(S / 2, S / 2);
                cx.fillStyle = color;
                // две эллиптические «пелюстки» без теней/градиентов
                cx.globalAlpha = 0.9;
                cx.beginPath(); cx.ellipse(0, 0, S * 0.19, S * 0.11, 0, 0, Math.PI * 2); cx.fill();
                cx.rotate(0.7);
                cx.beginPath(); cx.ellipse(0, 0, S * 0.19, S * 0.11, 0, 0, Math.PI * 2); cx.fill();
                return off;
            }
            function getSprite(color, s) {
                // группируем размеры по «корзинам», чтобы переиспользовать спрайты
                const bucket = Math.max(12, Math.round(s / 6) * 6);
                const key = color + '@' + bucket;
                let img = SPRITES.get(key);
                if (!img) { img = makeSprite(color, bucket); SPRITES.set(key, img); }
                return { img, size: bucket };
            }

            const petals = [];
            let running = false;
            let activity = 0; // 0..1
            let lastY = scrollY, lastT = performance.now();
            let spawnCool = 0;

            function drawPetal(p) {
                const { img, size } = getSprite(p.color, p.s);
                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.r);
                ctx.globalAlpha = 0.7 * p.life; // мягкое затухание, НО без «искорок»
                ctx.drawImage(img, -size / 2, -size / 2, size, size);
                ctx.restore();
            }

            function spawn(count, top = true, intensity = 1) {
                for (let i = 0; i < count && petals.length < MAX; i++) {
                    const s = (Math.random() * 18 + 10) * dpr;
                    petals.push({
                        x: Math.random() * c.width,
                        y: top ? (-30 - Math.random() * 60) * dpr : Math.random() * c.height * 0.2,
                        vx: (Math.random() - 0.5) * 0.06 * dpr * (0.7 + 0.6 * intensity),
                        vy: (SPEED_Y_MIN + Math.random() * (SPEED_Y_MAX - SPEED_Y_MIN)) * dpr * (0.8 + 0.7 * intensity),
                        r: Math.random() * Math.PI,
                        vr: (Math.random() - 0.5) * ROT_SPEED,
                        s, life: 1,
                        color: COLORS[(Math.random() * COLORS.length) | 0]
                    });
                }
                if (petals.length && !running) { running = true; requestAnimationFrame(loop); }
            }

            addEventListener('scroll', () => {
                const now = performance.now();
                const dy = Math.abs(scrollY - lastY);
                const dt = Math.max(16, now - lastT);
                lastY = scrollY; lastT = now;

                const speed = Math.min(1, dy / dt / 2.2);   // интенсивность скролла
                activity = Math.min(1, activity + speed * 0.85);

                if (spawnCool > 0) return;
                const burst = Math.min(40, Math.max(6,
                    Math.round(BURST_BASE + (dy / 100) * BURST_GAIN_PER_100PX)
                ));
                spawn(burst, true, 0.5 + speed);
                spawnCool = SPAWN_THROTTLE_MS;
                setTimeout(() => { spawnCool = 0; }, SPAWN_THROTTLE_MS);
            }, { passive: true });

            function loop(prev) {
                if (petals.length === 0) { running = false; return; }

                const now = performance.now();
                const dt = Math.min(32, now - (prev || now - 16));
                ctx.clearRect(0, 0, c.width, c.height);

                // скорость: очень медленно без скролла, быстро при нём
                activity *= 0.92;
                const k = IDLE_FACTOR + activity * (1 - IDLE_FACTOR);

                for (let i = petals.length - 1; i >= 0; i--) {
                    const p = petals[i];
                    p.x += p.vx * dt * k;
                    p.y += p.vy * dt * k;
                    p.r += p.vr * dt * (0.5 + 0.5 * k);
                    p.life -= LIFE_DECAY * dt * (0.6 + 0.9 * k);

                    drawPetal(p);

                    if (p.y > c.height + 30 * dpr || p.life <= 0) {
                        petals.splice(i, 1);
                    }
                }
                requestAnimationFrame(() => loop(now));
            }

            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) lastT = performance.now();
            });
        })();
    </script>



    
    <script>
        // ===============================
        // 6) Наклон секций при наклоне телефона + параллакс обложки
        // (v2: авто-фолбэк, заметнее эффекты, подсказки)
        // ===============================
        (function () {
            if (matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            document.querySelectorAll('.card, .detail').forEach(el => el.classList.add('tilt'));

            const root = document.documentElement;
            const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

            const cur = { rx:0, ry:0, tx:0, ty:0, gx:0, gy:0 };
            const tgt = { rx:0, ry:0, tx:0, ty:0, gx:0, gy:0 };
            const DAMP = 0.14;
            let raf = 0;

            function apply() {
                cur.rx += (tgt.rx - cur.rx) * DAMP;
                cur.ry += (tgt.ry - cur.ry) * DAMP;
                cur.tx += (tgt.tx - cur.tx) * DAMP;
                cur.ty += (tgt.ty - cur.ty) * DAMP;
                cur.gx += (tgt.gx - cur.gx) * DAMP;
                cur.gy += (tgt.gy - cur.gy) * DAMP;

                root.style.setProperty('--rx', cur.rx.toFixed(2) + 'deg');
                root.style.setProperty('--ry', cur.ry.toFixed(2) + 'deg');
                root.style.setProperty('--tx', cur.tx.toFixed(2) + 'px');
                root.style.setProperty('--ty', cur.ty.toFixed(2) + 'px');
                root.style.setProperty('--gx', cur.gx.toFixed(2) + 'px');
                root.style.setProperty('--gy', cur.gy.toFixed(2) + 'px');

                const still = Math.abs(tgt.rx - cur.rx) + Math.abs(tgt.ry - cur.ry) +
                              Math.abs(tgt.tx - cur.tx) + Math.abs(tgt.ty - cur.ty) +
                              Math.abs(tgt.gx - cur.gx) + Math.abs(tgt.gy - cur.gy);
                if (still > 0.02) raf = requestAnimationFrame(apply); else raf = 0;
            }
            function kick(){ if(!raf) raf = requestAnimationFrame(apply); }

            const maxDegX = 10, maxDegY = 10, maxTx = 16, maxTy = 16, maxGx = 22, maxGy = 16;
            let base = null;
            function fromAngles(beta, gamma) {
                if (!base) base = { beta, gamma };
                const b = clamp(beta - base.beta, -45, 45);
                const g = clamp(gamma - base.gamma, -45, 45);
                tgt.rx = clamp((b / 45) * maxDegX, -maxDegX, maxDegX);
                tgt.ry = clamp((g / 45) * maxDegY, -maxDegY, maxDegY);
                tgt.tx = clamp((g / 45) * maxTx, -maxTx, maxTx);
                tgt.ty = clamp((-b / 45) * maxTy, -maxTy, maxTy);
                tgt.gx = clamp((g / 45) * maxGx, -maxGx, maxGx);
                tgt.gy = clamp((-b / 45) * maxGy, -maxGy, maxGy);
                kick();
            }
            addEventListener('orientationchange', () => { base = null; }, { passive: true });

            // Fallbacks + hints
            let lastMotion = 0, fallbackOn = false;
            function enablePointerFallback(note) {
                if (fallbackOn) return;
                fallbackOn = true;
                if (note) showHint(note);
                addEventListener('pointermove', (e) => {
                    const nx = (e.clientX / innerWidth) * 2 - 1;
                    const ny = (e.clientY / innerHeight) * 2 - 1;
                    fromAngles(-ny * 30, nx * 30);
                }, { passive: true });
            }
            function showHint(text) {
                const hint = document.createElement('div');
                hint.textContent = text;
                Object.assign(hint.style, {
                    position:'fixed', left:'50%', transform:'translateX(-50%)',
                    bottom:'calc(16px + env(safe-area-inset-bottom))',
                    padding:'10px 14px', borderRadius:'999px', zIndex:'60',
                    font:'500 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif',
                    background:'rgba(30,30,30,.8)', color:'#fff',
                    backdropFilter:'saturate(140%) blur(6px)', WebkitBackdropFilter:'saturate(140%) blur(6px)',
                    opacity:'0', transition:'opacity .25s ease'
                });
                document.body.appendChild(hint);
                requestAnimationFrame(()=>{ hint.style.opacity='1'; });
                setTimeout(()=>{ hint.style.opacity='0'; setTimeout(()=>hint.remove(), 300); }, 2600);
            }

            function onDO(e) {
                const beta = typeof e.beta === 'number' ? e.beta : 0;
                const gamma = typeof e.gamma === 'number' ? e.gamma : 0;
                if (beta !== 0 || gamma !== 0) lastMotion = performance.now();
                fromAngles(beta, gamma);
            }

            function setupMotion() {
                const useDO = 'DeviceOrientationEvent' in window;
                if (!useDO) return false;
                const needPerm = typeof DeviceOrientationEvent.requestPermission === 'function';
                if (needPerm) {
                    const btn = document.createElement('button');
                    btn.id = 'tiltEnable';
                    btn.type = 'button';
                    btn.textContent = 'Включить наклон';
                    Object.assign(btn.style, {
                        position:'fixed', left:'50%', transform:'translateX(-50%)',
                        bottom:'calc(16px + env(safe-area-inset-bottom))',
                        zIndex:'50', padding:'10px 14px', borderRadius:'999px',
                        font:'600 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,sans-serif',
                        background:'rgba(255,255,255,.9)', color:'#111',
                        boxShadow:'0 6px 20px rgba(0,0,0,.12)', border:'1px solid rgba(0,0,0,.06)',
                        backdropFilter:'saturate(140%) blur(6px)', WebkitBackdropFilter:'saturate(140%) blur(6px)',
                    });
                    document.body.appendChild(btn);
                    btn.addEventListener('click', async () => {
                        try {
                            const res = await DeviceOrientationEvent.requestPermission();
                            if (res === 'granted') {
                                addEventListener('deviceorientation', onDO, { passive: true });
                                btn.remove();
                                showHint('Наклоните телефон');
                                setTimeout(() => {
                                    if (performance.now() - lastMotion > 1500) {
                                        enablePointerFallback('Датчик недоступен — используем касание');
                                    }
                                }, 1800);
                            } else {
                                btn.textContent = 'Доступ отклонён';
                                setTimeout(() => { enablePointerFallback('Используем касание'); btn.remove(); }, 1200);
                            }
                        } catch {
                            btn.textContent = 'Нет доступа к датчику';
                            setTimeout(() => { enablePointerFallback('Используем касание'); btn.remove(); }, 1200);
                        }
                    }, { passive: true });
                    return true;
                } else {
                    addEventListener('deviceorientation', onDO, { passive: true });
                    setTimeout(() => {
                        if (performance.now() - lastMotion > 1500) {
                            enablePointerFallback('Датчик недоступен — используем касание');
                        }
                    }, 1800);
                    return true;
                }
            }

            const hasMotion = setupMotion();
            if (!hasMotion) enablePointerFallback();

            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    tgt.rx = tgt.ry = tgt.tx = tgt.ty = tgt.gx = tgt.gy = 0; kick();
                }
            });
        })();
    </script>



<script>
(function(){
  const emmi = document.getElementById('nameEmmi');
  const tolya = document.getElementById('nameTolya');
  let audioCtx;

  function haptic(el, pattern=15){
    // Try native vibration (Android/Chrome)
    if (navigator && 'vibrate' in navigator) {
      try { navigator.vibrate(pattern); return; } catch(e){}
    }
    // iOS Safari fallback: a tiny visual pulse + very short click sound
    try {
      el.classList.add('haptic-pulse');
      setTimeout(()=> el.classList.remove('haptic-pulse'), 100);
      audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)(); window.__bgCtx = audioCtx;
      const now = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'square'; o.frequency.value = 160;
      o.connect(g); g.connect(audioCtx.destination);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.06, now + 0.005);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
      o.start(now); o.stop(now + 0.08);
    } catch(e){ /* ignore */ }
  }

  function spawnHeartAt(x, y, emoji){
    const d = document.createElement('div');
    d.className = 'love-heart';
    d.textContent = emoji; // 💗 or ❤️
    d.style.setProperty('--drift', (Math.random()*28 - 14) + 'px');
    d.style.setProperty('--rot',   (Math.random()*30 - 15) + 'deg');
    d.style.left = x + 'px';
    d.style.top  = (y - 8) + 'px';
    document.body.appendChild(d);
    d.addEventListener('animationend', ()=> d.remove(), {once:true});
  }

  function fire(e, emoji){
    const viaKeyboard = (e.type === 'keydown');
    let x, y;
    if (viaKeyboard){
      const r = e.currentTarget.getBoundingClientRect();
      x = r.left + r.width/2;
      y = r.top  + r.height/2;
    } else {
      x = e.clientX; y = e.clientY;
    }
    spawnHeartAt(x, y, emoji);
    haptic(e.currentTarget, 15);
  }

  function bind(el, emoji){
    if (!el) return;
    el.addEventListener('click',  (e)=> fire(e, emoji), {passive:true});
    el.addEventListener('keydown',(e)=> {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        fire(e, emoji);
      }
    });
  }

  bind(emmi, '💗');   // Эмми → розовое
  bind(tolya,'❤️');   // Толя → красное
})();
</script>

<!-- === Background music (local assets) === -->
<audio id="bgMusic" preload="auto" loop playsinline>
  <!-- Put your files into /assets; you can add more <source> lines -->
  <source src="assets/track-yng.mp3" type="audio/mpeg">
  <source src="assets/track-yng.ogg" type="audio/ogg">
</audio>
<button id="musicToggle" class="music-toggle" type="button" aria-label="Включить музыку" aria-pressed="false">
  <span class="icon" aria-hidden="true"></span>
</button>
<input id="musicFileInput" type="file" accept="audio/*">


<script id="music-js">
(function(){
  var audio = document.getElementById('bgMusic');
  var btn = document.getElementById('musicToggle') || document.querySelector('.music-toggle');
  if(!audio || !btn) return;

  function setUI(isPlaying){
    btn.classList.toggle('is-playing', !!isPlaying);
    btn.setAttribute('aria-pressed', isPlaying ? 'true' : 'false');
    btn.setAttribute('aria-label', isPlaying ? 'Пауза' : 'Включить музыку');
  }

  async function play(){
    try {
      if (window.__bgCtx && window.__bgCtx.state !== 'running') { await window.__bgCtx.resume(); }
    } catch(e){}
    var p = audio.play();
    if (p && typeof p.then==='function') { p.catch(function(){ /* ignored: requires gesture */ }); }
  }
  function pause(){ audio.pause(); }

  function toggle(){ audio.paused ? play() : pause(); }

  // keep UI in sync even if user uses system controls
  audio.addEventListener('play', function(){ setUI(true); });
  audio.addEventListener('pause', function(){ setUI(false); });

  // click handler
  btn.addEventListener('click', toggle, {passive:true});

  // pause when tab hidden
  document.addEventListener('visibilitychange', function(){
    if (document.hidden && !audio.paused) pause();
  });

  // initial state
  setUI(!audio.paused);
})();
</script>


<script id="volume-default">
document.addEventListener('DOMContentLoaded', function(){
  var a = document.getElementById('bgMusic'); if(a) a.volume = 0.45;
});
</script>


<!-- === Floating volume (bottom-left) === -->
<div class="music-volume" id="musicVolume">
  <button id="volumeBtn" class="volume-btn" type="button" aria-expanded="false" aria-label="Громкость">
    <span id="volumeIcon" class="icon" aria-hidden="true"></span>
  </button>
  <div id="volumePanel" class="volume-panel" role="group" aria-label="Управление громкостью">
    <div id="volLabel" class="vol-label">45%</div>
    <div class="vol-range-wrap">
      <input id="volRange" class="vol-range" type="range" min="0" max="100" step="1" value="45" aria-label="Громкость">
    </div>
  </div>
</div>


<script id="volume-autohide-js">
(function(){
  const panel = document.getElementById('volumePanel');
  const wrap  = document.getElementById('musicVolume');
  const btn   = document.getElementById('volumeBtn');
  const range = document.getElementById('volRange');
  if (!panel || !wrap) return;

  let hideTimer;
  function armAutoHide(delay){ 
    clearTimeout(hideTimer); 
    hideTimer = setTimeout(()=> panel.classList.remove('show'), delay || 3000); 
  }

  // When panel opens via button, start timer
  btn && btn.addEventListener('click', () => { 
    if (panel.classList.contains('show')) armAutoHide(3000); 
  }, {passive:true});

  // Any interaction inside the panel resets the timer
  wrap.addEventListener('pointerdown', ()=> armAutoHide(3000), {passive:true});
  wrap.addEventListener('pointerup',   ()=> armAutoHide(3000), {passive:true});
  range && range.addEventListener('input',  ()=> armAutoHide(3000));
  range && range.addEventListener('change', ()=> armAutoHide(3000));

  // Close on outside click already implemented in volume-js; nothing else needed here.
})();
</script>

<!-- === RSVP / Подтверждение участия === -->
<section class="wrap" id="rsvpSection" aria-label="Подтверждение участия">
  <div class="card tilt" style="--lift:0px">
    <h2>Подтвердите участие</h2>
    <p class="lead" id="rsvpIntro">Пожалуйста, отметьте, сможете ли вы прийти. Ваше имя подставится автоматически.</p>
    <div id="rsvpNameRow" style="display:none; margin-top:10px;">
      <label for="rsvpLastName" style="display:block; font-weight:600; margin:.5rem 0 .25rem;">Фамилия</label>
      <input id="rsvpLastName" type="text" placeholder="Иванов" style="width:100%; padding:.75rem 1rem; border:1px solid #ddd; border-radius:12px;" />
      <label for="rsvpFirstName" style="display:block; font-weight:600; margin:.75rem 0 .25rem;">Имя</label>
      <input id="rsvpFirstName" type="text" placeholder="Иван" style="width:100%; padding:.75rem 1rem; border:1px solid #ddd; border-radius:12px;" />
    </div>
    <div class="actions" style="margin-top:16px;">
      <button class="btn btn-primary" id="rsvpYes" type="button">Смогу прийти</button>
      <button class="btn btn-outline" id="rsvpNo" type="button">Не смогу прийти</button>
    </div>
    <div id="rsvpStatus" class="lead" style="margin-top:10px;"></div>
    <p style="font-size:.9rem; color:var(--muted); margin-top:8px;">Ответ сохраняется в таблицу. Если имени нет — введите его выше.</p>
  </div>
</section>
<script>
(function() { 
  const VARIANT = "yng"; // 'old' | 'yng'
  const ENDPOINT = "https://script.google.com/macros/s/AKfycbziWVr6gYXlTcySN4xcoV_OCU8NHQEMioSktK39JGT90acP76PddcFF4nnu_pTtL3pk/exec"; // ← замените на URL веб‑приложения Google Apps Script
  const yesBtn = document.getElementById('rsvpYes');
  const noBtn  = document.getElementById('rsvpNo');
  const msg    = document.getElementById('rsvpStatus');
  const nameRow= document.getElementById('rsvpNameRow');
  const fIn = document.getElementById('rsvpFirstName');
  const lIn = document.getElementById('rsvpLastName');

  (async function flushLocalBackup(){
  try{
    const key = 'rsvpLocalBackup';
    const arr = JSON.parse(localStorage.getItem(key) || '[]');
    if (!arr.length || !ENDPOINT) return;
    for (const item of arr) {
      await fetch(ENDPOINT, { method:'POST', body: JSON.stringify(item) });
    }
    localStorage.removeItem(key);
  }catch(e){}
})();

    
  // Prefill from localStorage
  let firstName = null, lastName = null;
  try { 
    firstName = localStorage.getItem('guestFirstName');
    lastName  = localStorage.getItem('guestLastName');
  } catch (e) {}
  if (!firstName || !lastName) {
    nameRow.style.display = 'block';
  } else {
    const intro = document.getElementById('rsvpIntro');
    intro.innerHTML = `Гость: <strong>${lastName} ${firstName}</strong>.`;
  }

  function lock(disabled) {
    yesBtn.disabled = disabled; noBtn.disabled = disabled;
    yesBtn.style.opacity = disabled ? .6 : 1; noBtn.style.opacity = disabled ? .6 : 1;
  }

  async function submitAnswer(willAttend) {
    const f = (firstName || fIn.value || '').trim();
    const l = (lastName  || lIn.value || '').trim();
    if (!l) { msg.textContent = 'Укажите фамилию.'; return; }
    if (!f) { msg.textContent = 'Укажите имя.'; return; }
    try { localStorage.setItem('guestFirstName', f); localStorage.setItem('guestLastName', l); } catch (e) {}

    const payload = { firstName: f, lastName: l, willAttend: !!willAttend, variant: VARIANT, ts: new Date().toISOString() };
    lock(true); msg.textContent = 'Отправляем ответ…';

    if (!ENDPOINT || ENDPOINT.indexOf('PASTE_GAS_WEB_APP_URL_HERE') !== -1) { 
      try { 
        const key = 'rsvpLocalBackup';
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        arr.push(payload);
        localStorage.setItem(key, JSON.stringify(arr));
        msg.innerHTML = 'Ответ сохранён локально. Настройте отправку в таблицу (см. инструкцию) и перезагрузите страницу — данные будут не потеряны.';
      } catch(e) { msg.textContent = 'Ответ сохранён локально.'; }
      return;
    }

    try { 
      const res = await fetch(ENDPOINT, {
        method: 'POST',
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      await res.json().catch(() => ({}));
      msg.innerHTML = 'Спасибо! Ваш ответ учтён: <strong>' + (willAttend ? 'Приду' : 'Не приду') + '</strong>.';
    } catch (e) { 
      msg.textContent = 'Не удалось отправить. Ответ сохранён локально — повторите позже.';
      try { 
        const key = 'rsvpLocalBackup';
        const arr = JSON.parse(localStorage.getItem(key) || '[]');
        arr.push(payload);
        localStorage.setItem(key, JSON.stringify(arr));
      } catch (_e) {}
    } finally { lock(true); }
  }

  yesBtn.addEventListener('click', () => submitAnswer(true));
  noBtn .addEventListener('click', () => submitAnswer(false));
})();
</script>
</body>
</html>
